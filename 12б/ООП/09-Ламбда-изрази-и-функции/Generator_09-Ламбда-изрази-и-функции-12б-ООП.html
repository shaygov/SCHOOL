<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ламбда изрази и функции — 12б, ООП</title>
    <style>
        body {
            font-family: 'DejaVu Serif', 'Times New Roman', serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #fd7e14;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #fd7e14;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        ul {
            margin: 15px 0;
        }
        
        li {
            margin: 8px 0;
        }
        
        code {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .example {
            background-color: #e8f5e8;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        
        .important {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        
        .config {
            background-color: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        
        .patterns {
            background-color: #f3e5f5;
            padding: 15px;
            border-left: 4px solid #9c27b0;
            margin: 15px 0;
        }
        
        .security {
            background-color: #ffebee;
            padding: 15px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
        }
        
        strong {
            color: #2c3e50;
        }
        
        .section-number {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .format-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-card {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        .format-card h4 {
            color: #fd7e14;
            margin-top: 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
            .format-comparison {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ламбда изрази и функции — 12б, ООП</h1>

        <h2><span class="section-number">1. Увод</span></h2>
        <div class="important">
            <p>Ламбда изразите са анонимни функции, които ни позволяват да пишем по-кратък и изразителен код. Те са особено полезни за работа с делегати, събития и LINQ заявки.</p>
        </div>

        <h2><span class="section-number">2. Какво са ламбда изразите?</span></h2>
        <div class="config">
            <h4>Ламбда изразите са:</h4>
            <ul>
                <li><strong>Анонимни функции</strong> - без име, директно използване</li>
                <li><strong>Кратък синтаксис</strong> - по-малко код за същата функционалност</li>
                <li><strong>Изразителни</strong> - ясно показват намерението</li>
                <li><strong>Функционални</strong> - могат да се предават като параметри</li>
                <li><strong>Затваряния</strong> - могат да използват променливи от външния обхват</li>
            </ul>
        </div>

        <h2><span class="section-number">3. Синтаксис на ламбда изразите</span></h2>
        
        <div class="config">
            <h4>Основен синтаксис:</h4>
            <ul>
                <li><strong>Параметри => израз</strong> - за изрази</li>
                <li><strong>Параметри => { блок }</strong> - за блокове от код</li>
                <li><strong>Тип параметри</strong> - (int x, int y) => x + y</li>
                <li><strong>Автоматично определяне</strong> - (x, y) => x + y</li>
                <li><strong>Един параметър</strong> - x => x * 2</li>
            </ul>
        </div>

        <div class="example">
            <h4>Основни примери с ламбда изрази:</h4>
            <pre><code>// Делегат за математически операции
delegate int MathOperation(int x, int y);

// Използване на ламбда изрази
MathOperation add = (x, y) => x + y;
MathOperation multiply = (x, y) => x * y;
MathOperation subtract = (x, y) => x - y;

// Извикване
int result1 = add(5, 3);        // 8
int result2 = multiply(4, 6);   // 24
int result3 = subtract(10, 4);  // 6

Console.WriteLine($"Събиране: {result1}");
Console.WriteLine($"Умножение: {result2}");
Console.WriteLine($"Изваждане: {result3}");

// Ламбда изрази с блокове
MathOperation complexOperation = (x, y) => {
    int temp = x * 2;
    return temp + y;
};

int result4 = complexOperation(3, 5); // 11
Console.WriteLine($"Сложна операция: {result4}");

// Ламбда изрази без параметри
Func<string> getMessage = () => "Здравей от ламбда израз!";
Console.WriteLine(getMessage());

// Ламбда изрази с един параметър
Func<int, int> square = x => x * x;
Func<string, int> getLength = s => s.Length;

Console.WriteLine($"Квадрат на 5: {square(5)}");
Console.WriteLine($"Дължина на 'Здравей': {getLength("Здравей")}");</code></pre>
        </div>

        <h2><span class="section-number">4. Вградени делегати</span></h2>
        
        <div class="config">
            <h4>Основни вградени делегати:</h4>
            <ul>
                <li><strong>Action</strong> - не връща стойност (void)</li>
                <li><strong>Func&lt;T&gt;</strong> - връща стойност от тип T</li>
                <li><strong>Predicate&lt;T&gt;</strong> - връща bool (за условия)</li>
                <li><strong>Comparison&lt;T&gt;</strong> - за сравняване на два обекта</li>
            </ul>
        </div>

        <div class="example">
            <h4>Примери с вградени делегати:</h4>
            <pre><code>// Action делегати
Action<string> printMessage = message => Console.WriteLine(message);
Action<int, int> printSum = (x, y) => Console.WriteLine($"Сума: {x + y}");

printMessage("Здравей от Action!");
printSum(10, 20);

// Func делегати
Func<int, int, int> add = (x, y) => x + y;
Func<string, string, string> concatenate = (s1, s2) => s1 + " " + s2;
Func<int, bool> isEven = x => x % 2 == 0;

Console.WriteLine($"Събиране: {add(5, 3)}");
Console.WriteLine($"Свързване: {concatenate("Здравей", "Свят")}");
Console.WriteLine($"4 е четно: {isEven(4)}");

// Predicate делегати
Predicate<int> isPositive = x => x > 0;
Predicate<string> isNotEmpty = s => !string.IsNullOrEmpty(s);

Console.WriteLine($"5 е положително: {isPositive(5)}");
Console.WriteLine($"'Здравей' не е празно: {isNotEmpty("Здравей")}");

// Comparison делегати
Comparison<int> compareNumbers = (x, y) => x.CompareTo(y);
Comparison<string> compareStrings = (s1, s2) => string.Compare(s1, s2);

Console.WriteLine($"Сравнение на 5 и 3: {compareNumbers(5, 3)}");
Console.WriteLine($"Сравнение на 'a' и 'b': {compareStrings("a", "b")}");</code></pre>
        </div>

        <h2><span class="section-number">5. Ламбда изрази с колекции</span></h2>
        
        <div class="config">
            <h4>LINQ методи с ламбда изрази:</h4>
            <ul>
                <li><strong>Where</strong> - филтриране на елементи</li>
                <li><strong>Select</strong> - трансформация на елементи</li>
                <li><strong>OrderBy</strong> - сортиране</li>
                <li><strong>GroupBy</strong> - групиране</li>
                <li><strong>Aggregate</strong> - агрегация</li>
            </ul>
        </div>

        <div class="example">
            <h4>Примери с LINQ и ламбда изрази:</h4>
            <pre><code>// Данни за тестване
var numbers = new List<int> { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
var names = new List<string> { "Иван", "Мария", "Петър", "Анна", "Георги" };
var students = new List<Student> {
    new Student("Иван", 20, 5.5),
    new Student("Мария", 19, 6.0),
    new Student("Петър", 21, 4.5),
    new Student("Анна", 18, 5.0),
    new Student("Георги", 22, 5.5)
};

// Where - филтриране
var evenNumbers = numbers.Where(x => x % 2 == 0);
var longNames = names.Where(name => name.Length > 4);
var excellentStudents = students.Where(s => s.Grade >= 5.5);

Console.WriteLine("Четни числа:");
foreach (var num in evenNumbers) {
    Console.WriteLine(num);
}

Console.WriteLine("\nДълги имена:");
foreach (var name in longNames) {
    Console.WriteLine(name);
}

Console.WriteLine("\nОтлични студенти:");
foreach (var student in excellentStudents) {
    Console.WriteLine(student);
}

// Select - трансформация
var squares = numbers.Select(x => x * x);
var upperNames = names.Select(name => name.ToUpper());
var studentInfo = students.Select(s => $"{s.Name} - {s.Grade}");

Console.WriteLine("\nКвадрати:");
foreach (var square in squares) {
    Console.WriteLine(square);
}

Console.WriteLine("\nГлавни букви:");
foreach (var name in upperNames) {
    Console.WriteLine(name);
}

Console.WriteLine("\nИнформация за студенти:");
foreach (var info in studentInfo) {
    Console.WriteLine(info);
}

// OrderBy - сортиране
var sortedNumbers = numbers.OrderBy(x => x);
var sortedNames = names.OrderBy(name => name.Length);
var sortedStudents = students.OrderBy(s => s.Grade).ThenBy(s => s.Name);

Console.WriteLine("\nСортирани числа:");
foreach (var num in sortedNumbers) {
    Console.WriteLine(num);
}

Console.WriteLine("\nСортирани по дължина:");
foreach (var name in sortedNames) {
    Console.WriteLine(name);
}

Console.WriteLine("\nСортирани студенти:");
foreach (var student in sortedStudents) {
    Console.WriteLine(student);
}

// GroupBy - групиране
var groupedByGrade = students.GroupBy(s => s.Grade);
var groupedByLength = names.GroupBy(name => name.Length);

Console.WriteLine("\nГрупирани по оценка:");
foreach (var group in groupedByGrade) {
    Console.WriteLine($"Оценка {group.Key}:");
    foreach (var student in group) {
        Console.WriteLine($"  {student.Name}");
    }
}

// Aggregate - агрегация
var sum = numbers.Aggregate((x, y) => x + y);
var product = numbers.Aggregate(1, (x, y) => x * y);
var concatenated = names.Aggregate((x, y) => x + ", " + y);

Console.WriteLine($"\nСума: {sum}");
Console.WriteLine($"Произведение: {product}");
Console.WriteLine($"Свързани имена: {concatenated}");</code></pre>
        </div>

        <h2><span class="section-number">6. Затваряния (Closures)</span></h2>
        
        <div class="config">
            <h4>Затварянията позволяват:</h4>
            <ul>
                <li><strong>Достъп до външни променливи</strong> - от обхвата на ламбда израза</li>
                <li><strong>Запазване на състояние</strong> - между извикванията</li>
                <li><strong>Функционално програмиране</strong> - създаване на функции</li>
                <li><strong>Конфигуриране на поведение</strong> - динамично задаване на параметри</li>
            </ul>
        </div>

        <div class="example">
            <h4>Примери с затваряния:</h4>
            <pre><code>// Затваряне с външна променлива
int multiplier = 10;
Func<int, int> multiplyByTen = x => x * multiplier;

Console.WriteLine($"5 * 10 = {multiplyByTen(5)}");

// Промяна на външната променлива
multiplier = 20;
Console.WriteLine($"5 * 20 = {multiplyByTen(5)}");

// Затваряне с множество променливи
string prefix = "Резултат: ";
int offset = 100;
Func<int, string> formatResult = x => $"{prefix}{x + offset}";

Console.WriteLine(formatResult(50));

// Затваряне в цикъл
var functions = new List<Func<int>>();
for (int i = 0; i < 5; i++) {
    int captured = i; // Важно: копиране на стойността
    functions.Add(() => captured * 2);
}

Console.WriteLine("\nЗатваряния в цикъл:");
foreach (var func in functions) {
    Console.WriteLine(func());
}

// Затваряне за създаване на функции
Func<int, Func<int, int>> createAdder = x => y => x + y;
var addFive = createAdder(5);
var addTen = createAdder(10);

Console.WriteLine($"5 + 3 = {addFive(3)}");
Console.WriteLine($"10 + 7 = {addTen(7)}");

// Затваряне за конфигуриране
Func<string, Func<string, bool>> createFilter = keyword => 
    text => text.ToLower().Contains(keyword.ToLower());

var containsHello = createFilter("hello");
var containsWorld = createFilter("world");

Console.WriteLine($"'Hello World' съдържа 'hello': {containsHello("Hello World")}");
Console.WriteLine($"'Hello World' съдържа 'world': {containsWorld("Hello World")}");</code></pre>
        </div>

        <h2><span class="section-number">7. Пълен пример - Система за филтриране</span></h2>
        
        <div class="highlight">
            <h4>Реален пример с ламбда изрази:</h4>
            <pre><code>// Клас за продукт
class Product {
    public string Name { get; set; }
    public decimal Price { get; set; }
    public string Category { get; set; }
    public int Stock { get; set; }
    public double Rating { get; set; }
    
    public Product(string name, decimal price, string category, int stock, double rating) {
        Name = name;
        Price = price;
        Category = category;
        Stock = stock;
        Rating = rating;
    }
    
    public override string ToString() {
        return $"{Name} - {Price:C} ({Category}) [Оценка: {Rating:F1}, Наличност: {Stock}]";
    }
}

// Клас за филтриране на продукти
class ProductFilter {
    private List<Product> products;
    
    public ProductFilter(List<Product> products) {
        this.products = products;
    }
    
    // Метод за филтриране с ламбда израз
    public List<Product> Filter(Func<Product, bool> predicate) {
        return products.Where(predicate).ToList();
    }
    
    // Метод за сортиране с ламбда израз
    public List<Product> SortBy<TKey>(Func<Product, TKey> keySelector) {
        return products.OrderBy(keySelector).ToList();
    }
    
    // Метод за групиране с ламбда израз
    public Dictionary<TKey, List<Product>> GroupBy<TKey>(Func<Product, TKey> keySelector) {
        return products.GroupBy(keySelector).ToDictionary(g => g.Key, g => g.ToList());
    }
    
    // Метод за трансформация с ламбда израз
    public List<TResult> Select<TResult>(Func<Product, TResult> selector) {
        return products.Select(selector).ToList();
    }
    
    // Метод за агрегация с ламбда израз
    public TResult Aggregate<TResult>(TResult seed, Func<TResult, Product, TResult> func) {
        return products.Aggregate(seed, func);
    }
    
    // Метод за търсене с ламбда израз
    public List<Product> Search(Func<Product, bool> searchPredicate) {
        return products.Where(searchPredicate).ToList();
    }
    
    // Метод за статистика
    public void DisplayStatistics() {
        Console.WriteLine($"Общо продукти: {products.Count}");
        Console.WriteLine($"Средна цена: {products.Average(p => p.Price):C}");
        Console.WriteLine($"Най-висока цена: {products.Max(p => p.Price):C}");
        Console.WriteLine($"Най-ниска цена: {products.Min(p => p.Price):C}");
        Console.WriteLine($"Средна оценка: {products.Average(p => p.Rating):F1}");
    }
}

// Използване
var products = new List<Product> {
    new Product("Laptop", 1500, "Електроника", 10, 4.5),
    new Product("Книга", 25, "Книги", 50, 4.2),
    new Product("Телефон", 800, "Електроника", 15, 4.8),
    new Product("Молив", 2, "Канцеларски", 100, 3.5),
    new Product("Монитор", 400, "Електроника", 8, 4.3),
    new Product("Роман", 30, "Книги", 25, 4.7),
    new Product("Тетрадка", 5, "Канцеларски", 200, 4.0),
    new Product("Таблет", 600, "Електроника", 12, 4.6)
};

var filter = new ProductFilter(products);

Console.WriteLine("=== Система за филтриране на продукти ===");
filter.DisplayStatistics();

// Филтриране по различни критерии
Console.WriteLine("\n=== Филтриране по цена (под 100 лв) ===");
var cheapProducts = filter.Filter(p => p.Price < 100);
foreach (var product in cheapProducts) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Филтриране по категория (Електроника) ===");
var electronics = filter.Filter(p => p.Category == "Електроника");
foreach (var product in electronics) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Филтриране по оценка (над 4.5) ===");
var highRated = filter.Filter(p => p.Rating > 4.5);
foreach (var product in highRated) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Филтриране по наличност (под 20) ===");
var lowStock = filter.Filter(p => p.Stock < 20);
foreach (var product in lowStock) {
    Console.WriteLine(product);
}

// Сортиране по различни критерии
Console.WriteLine("\n=== Сортиране по цена ===");
var sortedByPrice = filter.SortBy(p => p.Price);
foreach (var product in sortedByPrice) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Сортиране по оценка (низходящо) ===");
var sortedByRating = filter.SortBy(p => -p.Rating);
foreach (var product in sortedByRating) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Сортиране по име ===");
var sortedByName = filter.SortBy(p => p.Name);
foreach (var product in sortedByName) {
    Console.WriteLine(product);
}

// Групиране по категории
Console.WriteLine("\n=== Групиране по категории ===");
var groupedByCategory = filter.GroupBy(p => p.Category);
foreach (var group in groupedByCategory) {
    Console.WriteLine($"\n{group.Key}:");
    foreach (var product in group.Value) {
        Console.WriteLine($"  {product.Name} - {product.Price:C}");
    }
}

// Търсене с различни критерии
Console.WriteLine("\n=== Търсене по име (съдържа 'L') ===");
var searchResults = filter.Search(p => p.Name.ToLower().Contains("l"));
foreach (var product in searchResults) {
    Console.WriteLine(product);
}

Console.WriteLine("\n=== Търсене по цена и оценка ===");
var complexSearch = filter.Search(p => p.Price > 50 && p.Rating > 4.0);
foreach (var product in complexSearch) {
    Console.WriteLine(product);
}

// Агрегация
Console.WriteLine("\n=== Агрегация ===");
var totalValue = filter.Aggregate(0m, (sum, product) => sum + product.Price);
var totalStock = filter.Aggregate(0, (sum, product) => sum + product.Stock);
var averageRating = filter.Aggregate(0.0, (sum, product) => sum + product.Rating) / products.Count;

Console.WriteLine($"Обща стойност на наличностите: {totalValue:C}");
Console.WriteLine($"Общо количество: {totalStock}");
Console.WriteLine($"Средна оценка: {averageRating:F1}");

// Трансформация
Console.WriteLine("\n=== Трансформация ===");
var productNames = filter.Select(p => p.Name);
var productPrices = filter.Select(p => p.Price);
var productInfo = filter.Select(p => $"{p.Name}: {p.Price:C}");

Console.WriteLine("Имена на продуктите:");
foreach (var name in productNames) {
    Console.WriteLine($"  {name}");
}

Console.WriteLine("\nЦени на продуктите:");
foreach (var price in productPrices) {
    Console.WriteLine($"  {price:C}");
}

Console.WriteLine("\nИнформация за продуктите:");
foreach (var info in productInfo) {
    Console.WriteLine($"  {info}");
}</code></pre>
        </div>

        <h2><span class="section-number">8. Практически задачи</span></h2>
        <div class="highlight">
            <h4>Задачи за упражнение:</h4>
            <ul>
                <li><strong>Създай ламбда изрази</strong> за математически операции</li>
                <li><strong>Имплементирай филтриране</strong> на списък с числа</li>
                <li><strong>Направи сортиране</strong> с различни критерии</li>
                <li><strong>Създай търсене</strong> в колекция от обекти</li>
                <li><strong>Имплементирай агрегация</strong> с ламбда изрази</li>
            </ul>
        </div>

        <h2><span class="section-number">9. Заключение</span></h2>
        <div class="important">
            <p>Ламбда изразите са мощна функционалност, която ни позволява да пишем по-кратък, изразителен и функционален код, особено полезен за работа с колекции и делегати.</p>
        </div>

        <div class="patterns">
            <h4>Ключови принципи:</h4>
            <ul>
                <li><strong>Кратък синтаксис</strong> - по-малко код за същата функционалност</li>
                <li><strong>Функционално програмиране</strong> - предаване на функции като параметри</li>
                <li><strong>Затваряния</strong> - достъп до външни променливи</li>
                <li><strong>LINQ интеграция</strong> - мощни операции с колекции</li>
                <li><strong>Читаемост</strong> - по-ясен и изразителен код</li>
            </ul>
        </div>
    </div>
</body>
</html>




