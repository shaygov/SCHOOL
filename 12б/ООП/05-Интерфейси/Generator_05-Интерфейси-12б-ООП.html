<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерфейси — 12б, ООП</title>
    <style>
        body {
            font-family: 'DejaVu Serif', 'Times New Roman', serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #fd7e14;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #fd7e14;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        ul {
            margin: 15px 0;
        }
        
        li {
            margin: 8px 0;
        }
        
        code {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .example {
            background-color: #e8f5e8;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        
        .important {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        
        .config {
            background-color: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        
        .patterns {
            background-color: #f3e5f5;
            padding: 15px;
            border-left: 4px solid #9c27b0;
            margin: 15px 0;
        }
        
        .security {
            background-color: #ffebee;
            padding: 15px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
        }
        
        strong {
            color: #2c3e50;
        }
        
        .section-number {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .format-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-card {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        .format-card h4 {
            color: #fd7e14;
            margin-top: 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
            .format-comparison {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Интерфейси — 12б, ООП</h1>

        <h2><span class="section-number">1. Увод</span></h2>
        <div class="important">
            <p>Интерфейсите са контракти, които дефинират какво трябва да прави един клас, но не как да го прави. Те позволяват множествено наследяване и осигуряват гъвкавост в дизайна на програмите.</p>
        </div>

        <h2><span class="section-number">2. Какво е интерфейс?</span></h2>
        <div class="config">
            <h4>Интерфейсите са:</h4>
            <ul>
                <li><strong>Контракти</strong> - дефинират какво трябва да прави класът</li>
                <li><strong>Абстрактни</strong> - не съдържат имплементация</li>
                <li><strong>Множествено наследяване</strong> - клас може да имплементира много интерфейси</li>
                <li><strong>Публични</strong> - всички членове са публични</li>
                <li><strong>Принудителни</strong> - класът трябва да имплементира всички методи</li>
            </ul>
        </div>

        <h2><span class="section-number">3. Синтаксис на интерфейсите</span></h2>
        
        <div class="config">
            <h4>Основен синтаксис:</h4>
            <ul>
                <li><strong>interface ключова дума</strong> - дефинира интерфейс</li>
                <li><strong>I префикс</strong> - конвенция за именуване</li>
                <li><strong>Методи без имплементация</strong> - само декларация</li>
                <li><strong>Свойства</strong> - могат да се дефинират</li>
                <li><strong>Събития</strong> - могат да се дефинират</li>
            </ul>
        </div>

        <div class="example">
            <h4>Основен пример с интерфейс:</h4>
            <pre><code>// Дефиниране на интерфейс
interface IShape {
    double CalculateArea();
    double CalculatePerimeter();
    void DisplayInfo();
}

// Имплементация на интерфейса
class Rectangle : IShape {
    private double width;
    private double height;
    
    public Rectangle(double width, double height) {
        this.width = width;
        this.height = height;
    }
    
    // Имплементация на методите от интерфейса
    public double CalculateArea() {
        return width * height;
    }
    
    public double CalculatePerimeter() {
        return 2 * (width + height);
    }
    
    public void DisplayInfo() {
        Console.WriteLine($"Правоъгълник: {width}x{height}");
        Console.WriteLine($"Площ: {CalculateArea():F2}");
        Console.WriteLine($"Периметър: {CalculatePerimeter():F2}");
    }
}

class Circle : IShape {
    private double radius;
    
    public Circle(double radius) {
        this.radius = radius;
    }
    
    public double CalculateArea() {
        return Math.PI * radius * radius;
    }
    
    public double CalculatePerimeter() {
        return 2 * Math.PI * radius;
    }
    
    public void DisplayInfo() {
        Console.WriteLine($"Кръг с радиус: {radius}");
        Console.WriteLine($"Площ: {CalculateArea():F2}");
        Console.WriteLine($"Периметър: {CalculatePerimeter():F2}");
    }
}

// Използване
IShape shape1 = new Rectangle(5, 3);
IShape shape2 = new Circle(4);

shape1.DisplayInfo();
shape2.DisplayInfo();</code></pre>
        </div>

        <h2><span class="section-number">4. Множествено наследяване с интерфейси</span></h2>
        
        <div class="config">
            <h4>Предимства на множественото наследяване:</h4>
            <ul>
                <li><strong>Гъвкавост</strong> - клас може да има различни способности</li>
                <li><strong>Модулност</strong> - разделяне на функционалността</li>
                <li><strong>Преизползване</strong> - интерфейсите могат да се комбинират</li>
                <li><strong>Стандартизация</strong> - дефиниране на общи контракти</li>
            </ul>
        </div>

        <div class="example">
            <h4>Пример с множествено наследяване:</h4>
            <pre><code>// Интерфейс за летене
interface IFlyable {
    void Fly();
    double GetMaxAltitude();
}

// Интерфейс за плуване
interface ISwimmable {
    void Swim();
    double GetMaxDepth();
}

// Интерфейс за ходене
interface IWalkable {
    void Walk();
    double GetMaxSpeed();
}

// Интерфейс за звуци
interface ISoundable {
    void MakeSound();
    string GetSoundType();
}

// Клас, който имплементира множество интерфейси
class Duck : IFlyable, ISwimmable, IWalkable, ISoundable {
    private string name;
    private double maxAltitude;
    private double maxDepth;
    private double maxSpeed;
    
    public Duck(string name) {
        this.name = name;
        this.maxAltitude = 1000; // метра
        this.maxDepth = 5; // метра
        this.maxSpeed = 10; // км/ч
    }
    
    // Имплементация на IFlyable
    public void Fly() {
        Console.WriteLine($"{name} лети в небето");
    }
    
    public double GetMaxAltitude() {
        return maxAltitude;
    }
    
    // Имплементация на ISwimmable
    public void Swim() {
        Console.WriteLine($"{name} плува в езерото");
    }
    
    public double GetMaxDepth() {
        return maxDepth;
    }
    
    // Имплементация на IWalkable
    public void Walk() {
        Console.WriteLine($"{name} ходи по земята");
    }
    
    public double GetMaxSpeed() {
        return maxSpeed;
    }
    
    // Имплементация на ISoundable
    public void MakeSound() {
        Console.WriteLine($"{name} кряка: Quack! Quack!");
    }
    
    public string GetSoundType() {
        return "Крякане";
    }
    
    // Допълнителен метод
    public void DisplayAbilities() {
        Console.WriteLine($"Патокът {name} може да:");
        Console.WriteLine($"- Лети до {maxAltitude}м височина");
        Console.WriteLine($"- Плува до {maxDepth}м дълбочина");
        Console.WriteLine($"- Ходи със скорост {maxSpeed} км/ч");
        Console.WriteLine($"- Прави звук: {GetSoundType()}");
    }
}

// Използване
Duck duck = new Duck("Доналд");

// Използване чрез различни интерфейси
IFlyable flyable = duck;
ISwimmable swimmable = duck;
IWalkable walkable = duck;
ISoundable soundable = duck;

flyable.Fly();
swimmable.Swim();
walkable.Walk();
soundable.MakeSound();

duck.DisplayAbilities();</code></pre>
        </div>

        <h2><span class="section-number">5. Свойства и събития в интерфейси</span></h2>
        
        <div class="config">
            <h4>Интерфейсите могат да съдържат:</h4>
            <ul>
                <li><strong>Свойства</strong> - get и set аксесори</li>
                <li><strong>Събития</strong> - за комуникация между обекти</li>
                <li><strong>Индекси</strong> - за достъп като масиви</li>
                <li><strong>Методи</strong> - основната функционалност</li>
            </ul>
        </div>

        <div class="example">
            <h4>Пример с свойства и събития:</h4>
            <pre><code>// Интерфейс за уведомления
interface INotifiable {
    string Name { get; set; }
    string Email { get; set; }
    bool IsActive { get; set; }
    
    event EventHandler<string> NotificationReceived;
    
    void SendNotification(string message);
    void Subscribe();
    void Unsubscribe();
}

// Интерфейс за валидация
interface IValidatable {
    bool IsValid { get; }
    List<string> ValidationErrors { get; }
    
    bool Validate();
    void ClearErrors();
}

// Интерфейс за сериализация
interface ISerializable {
    string Serialize();
    void Deserialize(string data);
    string FileExtension { get; }
}

// Клас, който имплементира множество интерфейси
class User : INotifiable, IValidatable, ISerializable {
    private string name;
    private string email;
    private bool isActive;
    private List<string> validationErrors;
    
    public event EventHandler<string> NotificationReceived;
    
    public User(string name, string email) {
        this.name = name;
        this.email = email;
        this.isActive = true;
        this.validationErrors = new List<string>();
    }
    
    // Имплементация на INotifiable
    public string Name {
        get { return name; }
        set { name = value; }
    }
    
    public string Email {
        get { return email; }
        set { email = value; }
    }
    
    public bool IsActive {
        get { return isActive; }
        set { isActive = value; }
    }
    
    public void SendNotification(string message) {
        if (isActive) {
            Console.WriteLine($"Изпратено уведомление до {name} ({email}): {message}");
            NotificationReceived?.Invoke(this, message);
        }
    }
    
    public void Subscribe() {
        Console.WriteLine($"{name} се абонира за уведомления");
    }
    
    public void Unsubscribe() {
        Console.WriteLine($"{name} се отписва от уведомления");
        isActive = false;
    }
    
    // Имплементация на IValidatable
    public bool IsValid {
        get { return validationErrors.Count == 0; }
    }
    
    public List<string> ValidationErrors {
        get { return new List<string>(validationErrors); }
    }
    
    public bool Validate() {
        validationErrors.Clear();
        
        if (string.IsNullOrEmpty(name)) {
            validationErrors.Add("Името не може да бъде празно");
        }
        
        if (string.IsNullOrEmpty(email) || !email.Contains("@")) {
            validationErrors.Add("Невалиден email адрес");
        }
        
        return IsValid;
    }
    
    public void ClearErrors() {
        validationErrors.Clear();
    }
    
    // Имплементация на ISerializable
    public string Serialize() {
        return $"Name:{name};Email:{email};Active:{isActive}";
    }
    
    public void Deserialize(string data) {
        var parts = data.Split(';');
        foreach (var part in parts) {
            var keyValue = part.Split(':');
            if (keyValue.Length == 2) {
                switch (keyValue[0]) {
                    case "Name":
                        name = keyValue[1];
                        break;
                    case "Email":
                        email = keyValue[1];
                        break;
                    case "Active":
                        isActive = bool.Parse(keyValue[1]);
                        break;
                }
            }
        }
    }
    
    public string FileExtension {
        get { return ".user"; }
    }
}

// Използване
User user = new User("Иван Петров", "ivan@example.com");

// Валидация
if (user.Validate()) {
    Console.WriteLine("Потребителят е валиден");
} else {
    Console.WriteLine("Грешки при валидация:");
    foreach (var error in user.ValidationErrors) {
        Console.WriteLine($"- {error}");
    }
}

// Уведомления
user.NotificationReceived += (sender, message) => {
    Console.WriteLine($"Получено уведомление: {message}");
};

user.SendNotification("Добре дошли в системата!");

// Сериализация
string serialized = user.Serialize();
Console.WriteLine($"Сериализиран потребител: {serialized}");

User newUser = new User("", "");
newUser.Deserialize(serialized);
Console.WriteLine($"Възстановен потребител: {newUser.Name}");</code></pre>
        </div>

        <h2><span class="section-number">6. Наследяване на интерфейси</span></h2>
        
        <div class="config">
            <h4>Интерфейсите могат да се наследяват:</h4>
            <ul>
                <li><strong>От други интерфейси</strong> - наследяване на методи</li>
                <li><strong>Множествено наследяване</strong> - интерфейс може да наследява множество интерфейси</li>
                <li><strong>Разширяване</strong> - добавяне на нови методи</li>
                <li><strong>Комбиниране</strong> - създаване на сложни контракти</li>
            </ul>
        </div>

        <div class="example">
            <h4>Пример с наследяване на интерфейси:</h4>
            <pre><code>// Базов интерфейс за животни
interface IAnimal {
    string Name { get; set; }
    int Age { get; set; }
    void Eat();
    void Sleep();
}

// Интерфейс за домашни животни
interface IPet : IAnimal {
    string Owner { get; set; }
    void Play();
    void BePetted();
}

// Интерфейс за диви животни
interface IWildAnimal : IAnimal {
    string Habitat { get; set; }
    bool IsDangerous { get; }
    void Hunt();
}

// Интерфейс за летящи животни
interface IFlyingAnimal : IAnimal {
    double MaxAltitude { get; }
    void Fly();
}

// Интерфейс за плуващи животни
interface ISwimmingAnimal : IAnimal {
    double MaxDepth { get; }
    void Swim();
}

// Комбиниран интерфейс за водоплаващи птици
interface IWaterfowl : IFlyingAnimal, ISwimmingAnimal, IWildAnimal {
    string MigrationRoute { get; set; }
    void Migrate();
}

// Имплементация на сложния интерфейс
class Duck : IWaterfowl {
    public string Name { get; set; }
    public int Age { get; set; }
    public string Habitat { get; set; }
    public string MigrationRoute { get; set; }
    public double MaxAltitude { get; private set; }
    public double MaxDepth { get; private set; }
    
    public bool IsDangerous => false;
    
    public Duck(string name, int age) {
        Name = name;
        Age = age;
        Habitat = "Езеро";
        MigrationRoute = "Север-Юг";
        MaxAltitude = 1000;
        MaxDepth = 5;
    }
    
    // Имплементация на IAnimal
    public void Eat() {
        Console.WriteLine($"{Name} яде водни растения и малки рибки");
    }
    
    public void Sleep() {
        Console.WriteLine($"{Name} спи на водата");
    }
    
    // Имплементация на IWildAnimal
    public void Hunt() {
        Console.WriteLine($"{Name} лови малки рибки");
    }
    
    // Имплементация на IFlyingAnimal
    public void Fly() {
        Console.WriteLine($"{Name} лети до {MaxAltitude}м височина");
    }
    
    // Имплементация на ISwimmingAnimal
    public void Swim() {
        Console.WriteLine($"{Name} плува до {MaxDepth}м дълбочина");
    }
    
    // Имплементация на IWaterfowl
    public void Migrate() {
        Console.WriteLine($"{Name} мигрира по маршрута: {MigrationRoute}");
    }
    
    // Допълнителен метод
    public void DisplayInfo() {
        Console.WriteLine($"Паток: {Name}, {Age} години");
        Console.WriteLine($"Обиталище: {Habitat}");
        Console.WriteLine($"Миграционен маршрут: {MigrationRoute}");
        Console.WriteLine($"Максимална височина: {MaxAltitude}м");
        Console.WriteLine($"Максимална дълбочина: {MaxDepth}м");
        Console.WriteLine($"Опасен: {(IsDangerous ? "Да" : "Не")}");
    }
}

// Използване
Duck duck = new Duck("Доналд", 3);

// Използване чрез различни интерфейси
IAnimal animal = duck;
IWildAnimal wildAnimal = duck;
IFlyingAnimal flyingAnimal = duck;
ISwimmingAnimal swimmingAnimal = duck;
IWaterfowl waterfowl = duck;

animal.Eat();
wildAnimal.Hunt();
flyingAnimal.Fly();
swimmingAnimal.Swim();
waterfowl.Migrate();

duck.DisplayInfo();</code></pre>
        </div>

        <h2><span class="section-number">7. Пълен пример - Система за плащания</span></h2>
        
        <div class="highlight">
            <h4>Реален пример с множество интерфейси:</h4>
            <pre><code>// Интерфейс за плащания
interface IPayment {
    decimal Amount { get; set; }
    string Currency { get; set; }
    DateTime PaymentDate { get; set; }
    bool ProcessPayment();
    string GetPaymentDetails();
}

// Интерфейс за валидация
interface IValidatable {
    bool IsValid { get; }
    List<string> ValidationErrors { get; }
    bool Validate();
}

// Интерфейс за логиране
interface ILoggable {
    void Log(string message);
    string GetLogInfo();
}

// Интерфейс за нотификации
interface INotifiable {
    event EventHandler<string> PaymentProcessed;
    void SendNotification(string message);
}

// Интерфейс за рефундиране
interface IRefundable {
    bool CanRefund { get; }
    bool ProcessRefund();
    string GetRefundDetails();
}

// Интерфейс за криптиране
interface IEncryptable {
    string Encrypt(string data);
    string Decrypt(string encryptedData);
}

// Базов клас за плащания
public abstract class PaymentBase : IPayment, IValidatable, ILoggable, INotifiable {
    public decimal Amount { get; set; }
    public string Currency { get; set; }
    public DateTime PaymentDate { get; set; }
    public bool IsValid { get; private set; }
    public List<string> ValidationErrors { get; private set; }
    
    public event EventHandler<string> PaymentProcessed;
    
    protected PaymentBase(decimal amount, string currency) {
        Amount = amount;
        Currency = currency;
        PaymentDate = DateTime.Now;
        ValidationErrors = new List<string>();
        IsValid = false;
    }
    
    // Имплементация на IPayment
    public abstract bool ProcessPayment();
    
    public virtual string GetPaymentDetails() {
        return $"Плащане: {Amount:C} {Currency} на {PaymentDate:dd.MM.yyyy HH:mm}";
    }
    
    // Имплементация на IValidatable
    public virtual bool Validate() {
        ValidationErrors.Clear();
        
        if (Amount <= 0) {
            ValidationErrors.Add("Сумата трябва да е положителна");
        }
        
        if (string.IsNullOrEmpty(Currency)) {
            ValidationErrors.Add("Валутата не може да бъде празна");
        }
        
        if (PaymentDate > DateTime.Now) {
            ValidationErrors.Add("Датата на плащането не може да бъде в бъдещето");
        }
        
        IsValid = ValidationErrors.Count == 0;
        return IsValid;
    }
    
    // Имплементация на ILoggable
    public virtual void Log(string message) {
        Console.WriteLine($"[{DateTime.Now:HH:mm:ss}] {GetType().Name}: {message}");
    }
    
    public virtual string GetLogInfo() {
        return $"{GetType().Name} - {Amount:C} {Currency}";
    }
    
    // Имплементация на INotifiable
    public virtual void SendNotification(string message) {
        Log($"Изпратено уведомление: {message}");
        PaymentProcessed?.Invoke(this, message);
    }
    
    // Защитен метод за обща логика
    protected virtual void OnPaymentProcessed() {
        Log("Плащането е обработено успешно");
        SendNotification($"Плащането от {Amount:C} е завършено");
    }
}

// Конкретна имплементация за кредитна карта
public class CreditCardPayment : PaymentBase, IRefundable, IEncryptable {
    public string CardNumber { get; set; }
    public string CardHolderName { get; set; }
    public DateTime ExpiryDate { get; set; }
    public string CVV { get; set; }
    
    public bool CanRefund => PaymentDate.AddDays(30) > DateTime.Now;
    
    public CreditCardPayment(decimal amount, string currency, string cardNumber, 
                           string cardHolderName, DateTime expiryDate, string cvv) 
                           : base(amount, currency) {
        CardNumber = cardNumber;
        CardHolderName = cardHolderName;
        ExpiryDate = expiryDate;
        CVV = cvv;
    }
    
    public override bool ProcessPayment() {
        if (!Validate()) {
            Log("Плащането не е валидно");
            return false;
        }
        
        Log("Обработва се плащане с кредитна карта...");
        
        // Симулация на обработка
        if (SimulatePaymentProcessing()) {
            OnPaymentProcessed();
            return true;
        }
        
        Log("Плащането е неуспешно");
        return false;
    }
    
    public override bool Validate() {
        bool baseValid = base.Validate();
        
        if (string.IsNullOrEmpty(CardNumber) || CardNumber.Length != 16) {
            ValidationErrors.Add("Невалиден номер на карта");
        }
        
        if (string.IsNullOrEmpty(CardHolderName)) {
            ValidationErrors.Add("Името на притежателя не може да бъде празно");
        }
        
        if (ExpiryDate < DateTime.Now) {
            ValidationErrors.Add("Картата е изтекла");
        }
        
        if (string.IsNullOrEmpty(CVV) || CVV.Length != 3) {
            ValidationErrors.Add("Невалиден CVV код");
        }
        
        IsValid = baseValid && ValidationErrors.Count == 0;
        return IsValid;
    }
    
    public override string GetPaymentDetails() {
        return base.GetPaymentDetails() + 
               $"\nКарта: {MaskCardNumber(CardNumber)}" +
               $"\nПритежател: {CardHolderName}" +
               $"\nИзтича: {ExpiryDate:MM/yyyy}";
    }
    
    // Имплементация на IRefundable
    public bool ProcessRefund() {
        if (!CanRefund) {
            Log("Рефундът не е възможен - изтекла е 30-дневната граница");
            return false;
        }
        
        Log($"Обработва се рефунд от {Amount:C}");
        SendNotification($"Рефунд от {Amount:C} е обработен");
        return true;
    }
    
    public string GetRefundDetails() {
        return $"Рефунд: {Amount:C} {Currency} - {(CanRefund ? "Възможен" : "Не е възможен")}";
    }
    
    // Имплементация на IEncryptable
    public string Encrypt(string data) {
        // Проста симулация на криптиране
        return Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(data));
    }
    
    public string Decrypt(string encryptedData) {
        // Проста симулация на декриптиране
        return System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(encryptedData));
    }
    
    // Приватни помощни методи
    private bool SimulatePaymentProcessing() {
        // Симулация на успешно плащане
        return new Random().Next(1, 10) > 2; // 80% успех
    }
    
    private string MaskCardNumber(string cardNumber) {
        if (cardNumber.Length < 8) return "****";
        return cardNumber.Substring(0, 4) + " **** **** " + cardNumber.Substring(cardNumber.Length - 4);
    }
}

// Конкретна имплементация за банков превод
public class BankTransferPayment : PaymentBase, IRefundable {
    public string BankName { get; set; }
    public string AccountNumber { get; set; }
    public string RoutingNumber { get; set; }
    
    public bool CanRefund => PaymentDate.AddDays(7) > DateTime.Now;
    
    public BankTransferPayment(decimal amount, string currency, string bankName, 
                             string accountNumber, string routingNumber) 
                             : base(amount, currency) {
        BankName = bankName;
        AccountNumber = accountNumber;
        RoutingNumber = routingNumber;
    }
    
    public override bool ProcessPayment() {
        if (!Validate()) {
            Log("Плащането не е валидно");
            return false;
        }
        
        Log("Обработва се банков превод...");
        
        // Симулация на обработка
        if (SimulateBankTransfer()) {
            OnPaymentProcessed();
            return true;
        }
        
        Log("Банковият превод е неуспешен");
        return false;
    }
    
    public override bool Validate() {
        bool baseValid = base.Validate();
        
        if (string.IsNullOrEmpty(BankName)) {
            ValidationErrors.Add("Името на банката не може да бъде празно");
        }
        
        if (string.IsNullOrEmpty(AccountNumber) || AccountNumber.Length < 8) {
            ValidationErrors.Add("Невалиден номер на сметка");
        }
        
        if (string.IsNullOrEmpty(RoutingNumber) || RoutingNumber.Length != 9) {
            ValidationErrors.Add("Невалиден рутинг номер");
        }
        
        IsValid = baseValid && ValidationErrors.Count == 0;
        return IsValid;
    }
    
    public override string GetPaymentDetails() {
        return base.GetPaymentDetails() + 
               $"\nБанка: {BankName}" +
               $"\nСметка: {MaskAccountNumber(AccountNumber)}" +
               $"\nРутинг: {RoutingNumber}";
    }
    
    // Имплементация на IRefundable
    public bool ProcessRefund() {
        if (!CanRefund) {
            Log("Рефундът не е възможен - изтекла е 7-дневната граница");
            return false;
        }
        
        Log($"Обработва се рефунд от {Amount:C}");
        SendNotification($"Рефунд от {Amount:C} е обработен");
        return true;
    }
    
    public string GetRefundDetails() {
        return $"Рефунд: {Amount:C} {Currency} - {(CanRefund ? "Възможен" : "Не е възможен")}";
    }
    
    // Приватни помощни методи
    private bool SimulateBankTransfer() {
        // Симулация на успешен банков превод
        return new Random().Next(1, 10) > 1; // 90% успех
    }
    
    private string MaskAccountNumber(string accountNumber) {
        if (accountNumber.Length < 4) return "****";
        return "****" + accountNumber.Substring(accountNumber.Length - 4);
    }
}

// Използване
var creditCardPayment = new CreditCardPayment(1000, "BGN", "1234567890123456", 
                                            "Иван Петров", DateTime.Now.AddYears(2), "123");

var bankTransferPayment = new BankTransferPayment(500, "BGN", "Добротворна банка", 
                                                "1234567890", "123456789");

// Обработка на плащанията
Console.WriteLine("=== Обработка на плащания ===");

if (creditCardPayment.ProcessPayment()) {
    Console.WriteLine("Кредитната карта е обработена успешно");
    Console.WriteLine(creditCardPayment.GetPaymentDetails());
} else {
    Console.WriteLine("Грешки при обработка на кредитната карта:");
    foreach (var error in creditCardPayment.ValidationErrors) {
        Console.WriteLine($"- {error}");
    }
}

Console.WriteLine();

if (bankTransferPayment.ProcessPayment()) {
    Console.WriteLine("Банковият превод е обработен успешно");
    Console.WriteLine(bankTransferPayment.GetPaymentDetails());
} else {
    Console.WriteLine("Грешки при обработка на банковия превод:");
    foreach (var error in bankTransferPayment.ValidationErrors) {
        Console.WriteLine($"- {error}");
    }
}</code></pre>
        </div>

        <h2><span class="section-number">8. Практически задачи</span></h2>
        <div class="highlight">
            <h4>Задачи за упражнение:</h4>
            <ul>
                <li><strong>Създай интерфейс IReadable</strong> с методи за четене на данни</li>
                <li><strong>Имплементирай интерфейс IWritable</strong> с методи за записване</li>
                <li><strong>Направи интерфейс IComparable</strong> за сравняване на обекти</li>
                <li><strong>Създай интерфейс ICloneable</strong> за копиране на обекти</li>
                <li><strong>Имплементирай интерфейс IDisposable</strong> за освобождаване на ресурси</li>
            </ul>
        </div>

        <h2><span class="section-number">9. Заключение</span></h2>
        <div class="important">
            <p>Интерфейсите са мощна функционалност, която ни позволява да дефинираме контракти и да осигуряваме гъвкавост в дизайна на програмите чрез множествено наследяване.</p>
        </div>

        <div class="patterns">
            <h4>Ключови принципи:</h4>
            <ul>
                <li><strong>Контракти</strong> - дефиниране на задължителни методи</li>
                <li><strong>Множествено наследяване</strong> - клас може да имплементира множество интерфейси</li>
                <li><strong>Стандартизация</strong> - дефиниране на общи интерфейси</li>
                <li><strong>Гъвкавост</strong> - лесно добавяне на нови способности</li>
                <li><strong>Модулност</strong> - разделяне на функционалността</li>
            </ul>
        </div>
    </div>
</body>
</html>
