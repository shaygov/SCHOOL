<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Работа с обекти. Итератори и компаратори — 12б, ООП</title>
    <style>
        body {
            font-family: 'DejaVu Serif', 'Times New Roman', serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #fd7e14;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #fd7e14;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        ul {
            margin: 15px 0;
        }
        
        li {
            margin: 8px 0;
        }
        
        code {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .example {
            background-color: #e8f5e8;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        
        .important {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        
        .config {
            background-color: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        
        .patterns {
            background-color: #f3e5f5;
            padding: 15px;
            border-left: 4px solid #9c27b0;
            margin: 15px 0;
        }
        
        .security {
            background-color: #ffebee;
            padding: 15px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
        }
        
        strong {
            color: #2c3e50;
        }
        
        .section-number {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .format-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-card {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        .format-card h4 {
            color: #fd7e14;
            margin-top: 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
            .format-comparison {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Работа с обекти. Итератори и компаратори — 12б, ООП</h1>

        <h2><span class="section-number">1. Увод</span></h2>
        <div class="important">
            <p>Работата с обекти включва множество техники за манипулиране, сравняване и итериране. Итераторите и компараторите са ключови инструменти за ефективна работа с колекции от обекти.</p>
        </div>

        <h2><span class="section-number">2. Итератори (Iterators)</span></h2>
        <div class="config">
            <h4>Итераторите позволяват:</h4>
            <ul>
                <li><strong>Последователен достъп</strong> - до елементите на колекция</li>
                <li><strong>foreach цикли</strong> - автоматично итериране</li>
                <li><strong>yield return</strong> - лениво генериране на стойности</li>
                <li><strong>Кастомна логика</strong> - специфично поведение при итериране</li>
            </ul>
        </div>

        <div class="example">
            <h4>Основен пример с итератор:</h4>
            <pre><code>// Клас с итератор
class NumberSequence {
    private int start;
    private int end;
    private int step;
    
    public NumberSequence(int start, int end, int step = 1) {
        this.start = start;
        this.end = end;
        this.step = step;
    }
    
    // Итератор метод
    public IEnumerator<int> GetEnumerator() {
        for (int i = start; i <= end; i += step) {
            yield return i; // yield return за лениво генериране
        }
    }
    
    // Метод за обратно итериране
    public IEnumerable<int> GetReverseEnumerator() {
        for (int i = end; i >= start; i -= step) {
            yield return i;
        }
    }
    
    // Метод за филтриране
    public IEnumerable<int> GetEvenNumbers() {
        for (int i = start; i <= end; i += step) {
            if (i % 2 == 0) {
                yield return i;
            }
        }
    }
    
    // Метод за трансформация
    public IEnumerable<string> GetFormattedNumbers() {
        for (int i = start; i <= end; i += step) {
            yield return $"Число: {i}";
        }
    }
}

// Използване
var sequence = new NumberSequence(1, 10, 2);

Console.WriteLine("Обикновено итериране:");
foreach (int number in sequence) {
    Console.WriteLine(number);
}

Console.WriteLine("\nОбратно итериране:");
foreach (int number in sequence.GetReverseEnumerator()) {
    Console.WriteLine(number);
}

Console.WriteLine("\nЧетни числа:");
foreach (int number in sequence.GetEvenNumbers()) {
    Console.WriteLine(number);
}

Console.WriteLine("\nФорматирани числа:");
foreach (string formatted in sequence.GetFormattedNumbers()) {
    Console.WriteLine(formatted);
}</code></pre>
        </div>

        <h2><span class="section-number">3. Компаратори (Comparators)</span></h2>
        
        <div class="config">
            <h4>Видове компаратори:</h4>
            <ul>
                <li><strong>IComparable&lt;T&gt;</strong> - за сравняване на обекти</li>
                <li><strong>IComparer&lt;T&gt;</strong> - за външно сравняване</li>
                <li><strong>Comparison&lt;T&gt;</strong> - делегат за сравняване</li>
                <li><strong>Custom Comparers</strong> - специфична логика за сравняване</li>
            </ul>
        </div>

        <div class="example">
            <h4>Пример с IComparable:</h4>
            <pre><code>// Клас, който имплементира IComparable
class Student : IComparable<Student> {
    public string Name { get; set; }
    public int Age { get; set; }
    public double Grade { get; set; }
    
    public Student(string name, int age, double grade) {
        Name = name;
        Age = age;
        Grade = grade;
    }
    
    // Имплементация на IComparable
    public int CompareTo(Student other) {
        if (other == null) return 1;
        
        // Първо сравняваме по оценка (низходящо)
        int gradeComparison = other.Grade.CompareTo(this.Grade);
        if (gradeComparison != 0) return gradeComparison;
        
        // След това по име (възходящо)
        int nameComparison = this.Name.CompareTo(other.Name);
        if (nameComparison != 0) return nameComparison;
        
        // Накрая по възраст (възходящо)
        return this.Age.CompareTo(other.Age);
    }
    
    public override string ToString() {
        return $"{Name} ({Age}г, {Grade:F1})";
    }
}

// Използване
var students = new List<Student> {
    new Student("Иван", 20, 5.5),
    new Student("Мария", 19, 6.0),
    new Student("Петър", 21, 5.5),
    new Student("Анна", 18, 5.0),
    new Student("Иван", 20, 4.5)
};

Console.WriteLine("Преди сортиране:");
foreach (var student in students) {
    Console.WriteLine(student);
}

students.Sort(); // Използва IComparable

Console.WriteLine("\nСлед сортиране:");
foreach (var student in students) {
    Console.WriteLine(student);
}</code></pre>
        </div>

        <h2><span class="section-number">4. IComparer интерфейс</span></h2>
        
        <div class="config">
            <h4>Предимства на IComparer:</h4>
            <ul>
                <li><strong>Множествено сравняване</strong> - различни критерии</li>
                <li><strong>Външна логика</strong> - отделни класове за сравняване</li>
                <li><strong>Гъвкавост</strong> - лесно смяна на критериите</li>
                <li><strong>Преизползване</strong> - една логика за различни типове</li>
            </ul>
        </div>

        <div class="example">
            <h4>Пример с IComparer:</h4>
            <pre><code>// Компаратор за сравняване по име
class StudentNameComparer : IComparer<Student> {
    public int Compare(Student x, Student y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return string.Compare(x.Name, y.Name, StringComparison.OrdinalIgnoreCase);
    }
}

// Компаратор за сравняване по възраст
class StudentAgeComparer : IComparer<Student> {
    public int Compare(Student x, Student y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return x.Age.CompareTo(y.Age);
    }
}

// Компаратор за сравняване по оценка
class StudentGradeComparer : IComparer<Student> {
    public int Compare(Student x, Student y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return y.Grade.CompareTo(x.Grade); // Низходящо
    }
}

// Компаратор за сравняване по множество критерии
class StudentMultiComparer : IComparer<Student> {
    private string primaryCriteria;
    private string secondaryCriteria;
    
    public StudentMultiComparer(string primary, string secondary) {
        primaryCriteria = primary;
        secondaryCriteria = secondary;
    }
    
    public int Compare(Student x, Student y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        int primaryComparison = CompareByCriteria(x, y, primaryCriteria);
        if (primaryComparison != 0) return primaryComparison;
        
        return CompareByCriteria(x, y, secondaryCriteria);
    }
    
    private int CompareByCriteria(Student x, Student y, string criteria) {
        switch (criteria.ToLower()) {
            case "name":
                return string.Compare(x.Name, y.Name, StringComparison.OrdinalIgnoreCase);
            case "age":
                return x.Age.CompareTo(y.Age);
            case "grade":
                return y.Grade.CompareTo(x.Grade);
            default:
                return 0;
        }
    }
}

// Използване
var students = new List<Student> {
    new Student("Иван", 20, 5.5),
    new Student("Мария", 19, 6.0),
    new Student("Петър", 21, 5.5),
    new Student("Анна", 18, 5.0)
};

Console.WriteLine("Сортиране по име:");
students.Sort(new StudentNameComparer());
foreach (var student in students) {
    Console.WriteLine(student);
}

Console.WriteLine("\nСортиране по възраст:");
students.Sort(new StudentAgeComparer());
foreach (var student in students) {
    Console.WriteLine(student);
}

Console.WriteLine("\nСортиране по оценка:");
students.Sort(new StudentGradeComparer());
foreach (var student in students) {
    Console.WriteLine(student);
}

Console.WriteLine("\nСортиране по оценка, след това по име:");
students.Sort(new StudentMultiComparer("grade", "name"));
foreach (var student in students) {
    Console.WriteLine(student);
}</code></pre>
        </div>

        <h2><span class="section-number">5. Пълен пример - Система за управление на библиотека</span></h2>
        
        <div class="highlight">
            <h4>Реален пример с итератори и компаратори:</h4>
            <pre><code>// Клас за книга
class Book : IComparable<Book> {
    public string Title { get; set; }
    public string Author { get; set; }
    public int Year { get; set; }
    public string ISBN { get; set; }
    public decimal Price { get; set; }
    public int Pages { get; set; }
    public string Genre { get; set; }
    public bool IsAvailable { get; set; }
    
    public Book(string title, string author, int year, string isbn, 
                decimal price, int pages, string genre) {
        Title = title;
        Author = author;
        Year = year;
        ISBN = isbn;
        Price = price;
        Pages = pages;
        Genre = genre;
        IsAvailable = true;
    }
    
    public int CompareTo(Book other) {
        if (other == null) return 1;
        
        // Първо по заглавие
        int titleComparison = string.Compare(Title, other.Title, StringComparison.OrdinalIgnoreCase);
        if (titleComparison != 0) return titleComparison;
        
        // След това по автор
        return string.Compare(Author, other.Author, StringComparison.OrdinalIgnoreCase);
    }
    
    public override string ToString() {
        return $"{Title} от {Author} ({Year}) - {Price:C}";
    }
}

// Клас за библиотека с итератори
class Library : IEnumerable<Book> {
    private List<Book> books;
    private Dictionary<string, List<Book>> booksByGenre;
    private Dictionary<string, List<Book>> booksByAuthor;
    
    public Library() {
        books = new List<Book>();
        booksByGenre = new Dictionary<string, List<Book>>();
        booksByAuthor = new Dictionary<string, List<Book>>();
    }
    
    public void AddBook(Book book) {
        books.Add(book);
        
        // Индексиране по жанр
        if (!booksByGenre.ContainsKey(book.Genre)) {
            booksByGenre[book.Genre] = new List<Book>();
        }
        booksByGenre[book.Genre].Add(book);
        
        // Индексиране по автор
        if (!booksByAuthor.ContainsKey(book.Author)) {
            booksByAuthor[book.Author] = new List<Book>();
        }
        booksByAuthor[book.Author].Add(book);
    }
    
    public void RemoveBook(Book book) {
        books.Remove(book);
        booksByGenre[book.Genre]?.Remove(book);
        booksByAuthor[book.Author]?.Remove(book);
    }
    
    // Основен итератор
    public IEnumerator<Book> GetEnumerator() {
        foreach (var book in books) {
            yield return book;
        }
    }
    
    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator() {
        return GetEnumerator();
    }
    
    // Итератор за налични книги
    public IEnumerable<Book> GetAvailableBooks() {
        foreach (var book in books) {
            if (book.IsAvailable) {
                yield return book;
            }
        }
    }
    
    // Итератор за книги по жанр
    public IEnumerable<Book> GetBooksByGenre(string genre) {
        if (booksByGenre.ContainsKey(genre)) {
            foreach (var book in booksByGenre[genre]) {
                yield return book;
            }
        }
    }
    
    // Итератор за книги по автор
    public IEnumerable<Book> GetBooksByAuthor(string author) {
        if (booksByAuthor.ContainsKey(author)) {
            foreach (var book in booksByAuthor[author]) {
                yield return book;
            }
        }
    }
    
    // Итератор за книги в ценови диапазон
    public IEnumerable<Book> GetBooksInPriceRange(decimal minPrice, decimal maxPrice) {
        foreach (var book in books) {
            if (book.Price >= minPrice && book.Price <= maxPrice) {
                yield return book;
            }
        }
    }
    
    // Итератор за книги по година
    public IEnumerable<Book> GetBooksByYear(int year) {
        foreach (var book in books) {
            if (book.Year == year) {
                yield return book;
            }
        }
    }
    
    // Итератор за търсене по заглавие
    public IEnumerable<Book> SearchByTitle(string searchTerm) {
        foreach (var book in books) {
            if (book.Title.ToLower().Contains(searchTerm.ToLower())) {
                yield return book;
            }
        }
    }
    
    // Итератор за търсене по автор
    public IEnumerable<Book> SearchByAuthor(string searchTerm) {
        foreach (var book in books) {
            if (book.Author.ToLower().Contains(searchTerm.ToLower())) {
                yield return book;
            }
        }
    }
    
    // Метод за сортиране
    public void SortBooks(IComparer<Book> comparer = null) {
        if (comparer != null) {
            books.Sort(comparer);
        } else {
            books.Sort(); // Използва IComparable
        }
    }
    
    // Метод за показване на статистика
    public void DisplayStatistics() {
        Console.WriteLine($"Общо книги: {books.Count}");
        Console.WriteLine($"Налични книги: {GetAvailableBooks().Count()}");
        Console.WriteLine($"Жанрове: {booksByGenre.Count}");
        Console.WriteLine($"Автори: {booksByAuthor.Count}");
        
        Console.WriteLine("\nКниги по жанр:");
        foreach (var genre in booksByGenre.Keys) {
            Console.WriteLine($"  {genre}: {booksByGenre[genre].Count} книги");
        }
    }
}

// Компаратори за книги
class BookTitleComparer : IComparer<Book> {
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return string.Compare(x.Title, y.Title, StringComparison.OrdinalIgnoreCase);
    }
}

class BookAuthorComparer : IComparer<Book> {
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return string.Compare(x.Author, y.Author, StringComparison.OrdinalIgnoreCase);
    }
}

class BookYearComparer : IComparer<Book> {
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return y.Year.CompareTo(x.Year); // Низходящо
    }
}

class BookPriceComparer : IComparer<Book> {
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return x.Price.CompareTo(y.Price); // Възходящо
    }
}

class BookPagesComparer : IComparer<Book> {
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        return y.Pages.CompareTo(x.Pages); // Низходящо
    }
}

// Компаратор за множество критерии
class BookMultiComparer : IComparer<Book> {
    private string[] criteria;
    
    public BookMultiComparer(params string[] criteria) {
        this.criteria = criteria;
    }
    
    public int Compare(Book x, Book y) {
        if (x == null && y == null) return 0;
        if (x == null) return -1;
        if (y == null) return 1;
        
        foreach (var criterion in criteria) {
            int comparison = CompareByCriterion(x, y, criterion);
            if (comparison != 0) return comparison;
        }
        
        return 0;
    }
    
    private int CompareByCriterion(Book x, Book y, string criterion) {
        switch (criterion.ToLower()) {
            case "title":
                return string.Compare(x.Title, y.Title, StringComparison.OrdinalIgnoreCase);
            case "author":
                return string.Compare(x.Author, y.Author, StringComparison.OrdinalIgnoreCase);
            case "year":
                return y.Year.CompareTo(x.Year);
            case "price":
                return x.Price.CompareTo(y.Price);
            case "pages":
                return y.Pages.CompareTo(x.Pages);
            case "genre":
                return string.Compare(x.Genre, y.Genre, StringComparison.OrdinalIgnoreCase);
            default:
                return 0;
        }
    }
}

// Използване
var library = new Library();

// Добавяне на книги
library.AddBook(new Book("C# Programming", "Иван Петров", 2023, "978-1234567890", 50, 400, "Програмиране"));
library.AddBook(new Book("OOP Principles", "Мария Георгиева", 2022, "978-0987654321", 45, 350, "Програмиране"));
library.AddBook(new Book("Database Design", "Петър Стоянов", 2023, "978-1122334455", 55, 300, "Бази данни"));
library.AddBook(new Book("Web Development", "Анна Димитрова", 2022, "978-5566778899", 60, 450, "Web"));
library.AddBook(new Book("Algorithms", "Иван Петров", 2021, "978-9988776655", 40, 500, "Алгоритми"));

Console.WriteLine("=== Библиотечна система ===");
library.DisplayStatistics();

Console.WriteLine("\n=== Всички книги ===");
foreach (var book in library) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Книги по жанр 'Програмиране' ===");
foreach (var book in library.GetBooksByGenre("Програмиране")) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Книги от Иван Петров ===");
foreach (var book in library.GetBooksByAuthor("Иван Петров")) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Книги в ценови диапазон 40-50 лв ===");
foreach (var book in library.GetBooksInPriceRange(40, 50)) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Търсене по заглавие 'C#' ===");
foreach (var book in library.SearchByTitle("C#")) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Сортиране по заглавие ===");
library.SortBooks(new BookTitleComparer());
foreach (var book in library) {
    Console.WriteLine(book);
}

Console.WriteLine("\n=== Сортиране по автор, след това по заглавие ===");
library.SortBooks(new BookMultiComparer("author", "title"));
foreach (var book in library) {
    Console.WriteLine(book);
}</code></pre>
        </div>

        <h2><span class="section-number">6. Практически задачи</span></h2>
        <div class="highlight">
            <h4>Задачи за упражнение:</h4>
            <ul>
                <li><strong>Създай клас Product</strong> с итератор за различни критерии</li>
                <li><strong>Имплементирай IComparable</strong> за сравняване на продукти</li>
                <li><strong>Направи компаратори</strong> за сортиране по цена, име, категория</li>
                <li><strong>Създай итератор</strong> за филтриране на продукти</li>
                <li><strong>Имплементирай търсене</strong> с различни критерии</li>
            </ul>
        </div>

        <h2><span class="section-number">7. Заключение</span></h2>
        <div class="important">
            <p>Итераторите и компараторите са мощни инструменти за работа с обекти, които ни позволяват да създаваме гъвкави и ефективни системи за манипулиране на данни.</p>
        </div>

        <div class="patterns">
            <h4>Ключови принципи:</h4>
            <ul>
                <li><strong>Итератори</strong> - последователен достъп до елементи</li>
                <li><strong>Компаратори</strong> - различни критерии за сравняване</li>
                <li><strong>yield return</strong> - лениво генериране на стойности</li>
                <li><strong>Гъвкавост</strong> - лесно добавяне на нови критерии</li>
                <li><strong>Преизползване</strong> - една логика за различни типове</li>
            </ul>
        </div>
    </div>
</body>
</html>
