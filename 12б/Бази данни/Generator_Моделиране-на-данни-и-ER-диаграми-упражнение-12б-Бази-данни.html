<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Моделиране на данни и E/R диаграми (упражнение), Бази данни</title>
    <style>
        body {
            font-family: 'DejaVu Serif', 'Times New Roman', serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        ul {
            margin: 15px 0;
        }
        
        li {
            margin: 8px 0;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .example {
            background-color: #e8f5e8;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        
        .important {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        
        .section-number {
            color: #3498db;
            font-weight: bold;
        }
        
        .er-diagram {
            display: block;
            margin: 10px auto;
            max-width: 100%;
        }
        
        .no-break {
            break-inside: avoid;
            page-break-inside: avoid;
        }
        
        .section {
            margin: 20px 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
            .no-break, .section, h2, h3, .example, .highlight, .important {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            svg, img, figure {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
    <meta name="description" content="Кратък урок по моделиране на данни и ER диаграми за 12б - упражнения с прости примери.">
</head>
<body>
    <div class="container">
        <h1>Моделиране на данни и E/R диаграми (упражнение)</h1>

        <div class="section no-break">
            <h2><span class="section-number">1.</span> Увод</h2>
            <p><strong>1.1</strong> Моделирането на данни ни помага да опишем обектите от реалния свят (ентитети), техните свойства (атрибути) и връзките помежду им. E/R диаграмите са прост начин да визуализираме тези връзки преди да създадем таблиците.</p>
        </div>

        <div class="section no-break">
            <h2><span class="section-number">2.</span> Основни понятия</h2>
            <ul>
                <li><strong>Ентитет</strong>: обект от реалния свят, който искаме да съхраняваме (напр. <em>Student</em>).</li>
                <li><strong>Атрибут</strong>: характеристика на ентитета (напр. <em>FullName</em>).</li>
                <li><strong>Идентификатор</strong>: атрибут(и), които уникално различават записите (PK).</li>
                <li><strong>Връзка</strong>: как ентитетите се свързват (1:1, 1:N, N:M).</li>
                <li><strong>Кардиналност</strong>: какъв е броят на участието (единичен/много).</li>
            </ul>
            <h3>2.1 Кардиналност накратко</h3>
            <p><strong>Какво е</strong>: колко елемента от единия тип могат да са свързани с елемент от другия.</p>
            <ul>
                <li><strong>1:1</strong>: един към един (напр. човек ↔ паспорт).</li>
                <li><strong>1:N</strong>: един към много (напр. клиент ↔ поръчки).</li>
                <li><strong>N:M</strong>: много към много (напр. студент ↔ група).</li>
                <li><strong>0..N, 1..N</strong>: 0 означава по избор, 1 означава задължително участие.</li>
            </ul>
        </div>

        <div class="section no-break">
            <h2><span class="section-number">3.</span> Прости примери с E/R диаграми</h2>
            <h3>3.1 Студенти и групи (N:M чрез междинна таблица)</h3>
            <div class="example no-break">
                <p><strong>Идея</strong>: Един студент може да е в много групи, а една група има много студенти.</p>
                <svg class="er-diagram" viewBox="0 0 720 250" xmlns="http://www.w3.org/2000/svg" aria-label="ER диаграма Студенти-Групи">
                    <defs>
                        <style>
                            .box{fill:#ffffff;stroke:#2c3e50;stroke-width:2}
                            .title{fill:#2c3e50;font: bold 14px 'DejaVu Serif','Times New Roman',serif}
                            .attr{fill:#34495e;font: 12px 'DejaVu Serif','Times New Roman',serif}
                            .rel{stroke:#2c3e50;stroke-width:2;marker-end:url(#arrow)}
                            .card{fill:#2c3e50;font: 12px 'DejaVu Serif','Times New Roman',serif}
                        </style>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2c3e50" />
                        </marker>
                    </defs>
                    <!-- Student entity -->
                    <rect x="40" y="40" width="200" height="110" rx="6" class="box" />
                    <text x="140" y="60" text-anchor="middle" class="title">Students</text>
                    <text x="60" y="85" class="attr">StudentId (PK)</text>
                    <text x="60" y="105" class="attr">EGN (UNIQUE)</text>
                    <text x="60" y="125" class="attr">FullName</text>

                    <!-- Groups entity -->
                    <rect x="480" y="40" width="200" height="110" rx="6" class="box" />
                    <text x="580" y="60" text-anchor="middle" class="title">Groups</text>
                    <text x="500" y="85" class="attr">GroupId (PK)</text>
                    <text x="500" y="105" class="attr">Name</text>

                    <!-- Junction -->
                    <rect x="260" y="155" width="200" height="70" rx="6" class="box" />
                    <text x="360" y="175" text-anchor="middle" class="title">StudentGroups</text>
                    <text x="280" y="200" class="attr">(StudentId, GroupId) (PK, FK)</text>

                    <!-- Relations -->
                    <line x1="240" y1="95" x2="300" y2="155" class="rel" />
                    <line x1="480" y1="95" x2="420" y2="155" class="rel" />
                    <text x="265" y="110" class="card">1..N</text>
                    <text x="455" y="110" class="card">1..N</text>
                </svg>
            </div>

            <h3>3.2 Поръчки: Клиент (1:N) Поръчки</h3>
            <div class="example no-break">
                <p><strong>Идея</strong>: Един клиент има много поръчки; всяка поръчка принадлежи на един клиент.</p>
                <svg class="er-diagram" viewBox="0 0 720 220" xmlns="http://www.w3.org/2000/svg" aria-label="ER диаграма Клиент-Поръчки">
                    <defs>
                        <style>
                            .box{fill:#ffffff;stroke:#2c3e50;stroke-width:2}
                            .title{fill:#2c3e50;font: bold 14px 'DejaVu Serif','Times New Roman',serif}
                            .attr{fill:#34495e;font: 12px 'DejaVu Serif','Times New Roman',serif}
                            .rel{stroke:#2c3e50;stroke-width:2;marker-end:url(#arrow2)}
                            .card{fill:#2c3e50;font: 12px 'DejaVu Serif','Times New Roman',serif}
                        </style>
                        <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2c3e50" />
                        </marker>
                    </defs>
                    <!-- Customer entity -->
                    <rect x="60" y="50" width="220" height="100" rx="6" class="box" />
                    <text x="170" y="70" text-anchor="middle" class="title">Customers</text>
                    <text x="80" y="95" class="attr">CustomerId (PK)</text>
                    <text x="80" y="115" class="attr">Email (UNIQUE)</text>

                    <!-- Orders entity -->
                    <rect x="440" y="50" width="220" height="100" rx="6" class="box" />
                    <text x="550" y="70" text-anchor="middle" class="title">Orders</text>
                    <text x="460" y="95" class="attr">OrderId (PK)</text>
                    <text x="460" y="115" class="attr">CustomerId (FK)</text>

                    <!-- Relation -->
                    <line x1="280" y1="100" x2="440" y2="100" class="rel" />
                    <text x="305" y="90" class="card">1..N</text>
                </svg>
            </div>
        </div>

        <div class="section no-break">
            <h2><span class="section-number">4.</span> От ER към таблици (релационен модел)</h2>
            <ul>
                <li><strong>1:N</strong>: FK в таблицата от страната „много“.</li>
                <li><strong>N:M</strong>: междинна таблица с композитен PK от двата FK.</li>
                <li><strong>1:1</strong>: рядко; често се реализира с уникален FK.</li>
            </ul>
            <div class="example">
                <h4>Пример (SQL): Студенти, Групи, Членства</h4>
                <pre><code>CREATE TABLE Students (
  StudentId SERIAL PRIMARY KEY,
  EGN CHAR(10) UNIQUE NOT NULL,
  FullName VARCHAR(100) NOT NULL
);

CREATE TABLE `Groups` (
  GroupId SERIAL PRIMARY KEY,
  Name VARCHAR(100) NOT NULL
);

CREATE TABLE StudentGroups (
  StudentId INT NOT NULL,
  GroupId INT NOT NULL,
  JoinedAt TIMESTAMP NOT NULL DEFAULT NOW(),
  PRIMARY KEY (StudentId, GroupId),
  FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
  FOREIGN KEY (GroupId) REFERENCES `Groups`(GroupId) ON DELETE CASCADE
);
                </code></pre>
            </div>
        </div>

        <div class="section no-break">
            <h2><span class="section-number">5.</span> Кратки задачи</h2>
            <div class="highlight">
                <ul>
                    <li>Нарисувай ER диаграма за библиотека: Readers, Books, Loans (N:M).</li>
                    <li>Добави атрибути и избери идентификатори (PK/FK).</li>
                    <li>Реши как ще реализираш връзките в таблици.</li>
                </ul>
            </div>
        </div>

        <div class="section no-break">
            <h2><span class="section-number">6.</span> Заключение</h2>
            <div class="important">
                <p><strong>6.1</strong> E/R диаграмите улесняват преминаването от идея към правилен релационен модел с ясни ключове и връзки.</p>
            </div>
        </div>
        <div class="section no-break">
            <h2><span class="section-number">7.</span> JOIN: свързване на таблици</h2>
            <p><strong>Идея</strong>: JOIN комбинира редове от свързани таблици (по PK/FK), за да получим смислени резултати.</p>
            <div class="example">
                <h4>7.1 INNER JOIN (N:M чрез междинна таблица)</h4>
                <pre><code>-- Студентите с техните групи
SELECT s.FullName, g.Name AS GroupName
FROM Students s
JOIN StudentGroups sg ON sg.StudentId = s.StudentId
JOIN `Groups` g ON g.GroupId = sg.GroupId
ORDER BY s.FullName, g.Name;
                </code></pre>
            </div>
            <div class="example">
                <h4>7.2 LEFT JOIN (всички студенти, дори без група)</h4>
                <pre><code>SELECT s.FullName, g.Name AS GroupName
FROM Students s
LEFT JOIN StudentGroups sg ON sg.StudentId = s.StudentId
LEFT JOIN `Groups` g ON g.GroupId = sg.GroupId
ORDER BY s.FullName;
                </code></pre>
            </div>
            <div class="highlight">
                <p><strong>Съвет</strong>: INNER JOIN връща само съвпадения; LEFT JOIN връща всички от лявата таблица + NULL за липсващи съвпадения.</p>
            </div>
            <div class="example">
                <h4>7.3 RIGHT JOIN (всички групи, дори без студенти)</h4>
                <pre><code>SELECT g.Name AS GroupName, s.FullName
FROM `Groups` g
RIGHT JOIN StudentGroups sg ON sg.GroupId = g.GroupId
RIGHT JOIN Students s ON s.StudentId = sg.StudentId
ORDER BY g.Name, s.FullName;
                </code></pre>
            </div>
            <div class="example">
                <h4>7.4 GROUP BY + COUNT (брой студенти по група)</h4>
                <pre><code>SELECT g.Name AS GroupName, COUNT(sg.StudentId) AS StudentCount
FROM `Groups` g
LEFT JOIN StudentGroups sg ON sg.GroupId = g.GroupId
GROUP BY g.GroupId, g.Name
ORDER BY g.Name;
                </code></pre>
            </div>
            <div class="highlight">
                <p><strong>XAMPP импорт на данни</strong>: отворете phpMyAdmin → изберете база <code>school_db</code> → Import → изберете файла <code>01_seed_students_groups.sql</code> от папката на урока → Go.</p>
            </div>
        </div>
    </div>
</body>
</html>


