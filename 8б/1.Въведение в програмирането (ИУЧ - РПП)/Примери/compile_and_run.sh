#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –∑–∞ –∫–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ –∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ C# –ø—Ä–∏–º–µ—Ä–∏
# –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ: ./compile_and_run.sh [–∏–º–µ_–Ω–∞_—Ñ–∞–π–ª–∞.cs]

echo "=== C# –ö–æ–º–ø–∏–ª–∞—Ç–æ—Ä –∏ –ò–∑–ø—ä–ª–Ω–∏—Ç–µ–ª ==="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –µ –ø–æ–¥–∞–¥–µ–Ω –∞—Ä–≥—É–º–µ–Ω—Ç
if [ $# -eq 0 ]; then
    echo "–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ: $0 [–∏–º–µ_–Ω–∞_—Ñ–∞–π–ª–∞.cs]"
    echo ""
    echo "–ù–∞–ª–∏—á–Ω–∏ –ø—Ä–∏–º–µ—Ä–∏:"
    ls -1 *.cs | grep -v Template
    exit 1
fi

# –ò–º–µ –Ω–∞ —Ñ–∞–π–ª–∞
FILENAME="$1"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Ñ–∞–π–ª—ä—Ç —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
if [ ! -f "$FILENAME" ]; then
    echo "–ì—Ä–µ—à–∫–∞: –§–∞–π–ª—ä—Ç '$FILENAME' –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞!"
    exit 1
fi

# –ò–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–∏–º–∏—è —Ñ–∞–π–ª (–±–µ–∑ —Ä–∞–∑—à–∏—Ä–µ–Ω–∏–µ—Ç–æ)
EXECUTABLE="${FILENAME%.cs}"

echo "–ö–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ –Ω–∞ $FILENAME..."

# –ö–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ
mcs -out:"$EXECUTABLE" "$FILENAME"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –∫–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ—Ç–æ –µ —É—Å–ø–µ—à–Ω–æ
if [ $? -eq 0 ]; then
    echo "‚úÖ –ö–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ—Ç–æ –µ —É—Å–ø–µ—à–Ω–æ!"
    echo "–ò–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞..."
    echo "================================"
    
    # –ò–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
    mono "$EXECUTABLE"
    
    echo "================================"
    echo "‚úÖ –ü—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ –ø—Ä–∏–∫–ª—é—á–∏!"
    
    # –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–∏–º–∏—è —Ñ–∞–π–ª
    rm -f "$EXECUTABLE"
    echo "üßπ –ò–∑–ø—ä–ª–Ω–∏–º–∏—è—Ç —Ñ–∞–π–ª –µ –∏–∑—Ç—Ä–∏—Ç."
else
    echo "‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ!"
    exit 1
fi
